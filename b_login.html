<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betreuer Login - Stadtranderholung</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="main.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div class="login-container">
            <div class="login-card">
                <div class="card-header betreuer">
                    <div class="admin-icon">üë•</div>
                    <h2 class="mb-0">Betreuer Login</h2>
                    <p class="mb-0 mt-2">Stadtranderholung 2025</p>
                </div>
                <div class="card-body">
                    <div id="alertContainer"></div>

                    <form @submit.prevent="login">
                        <div class="mb-3">
                            <label for="betreuerName" class="form-label">Name des Betreuers</label>
                            <input type="text" class="form-control" id="betreuerName" v-model="betreuerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="groupNumber" class="form-label">Gruppennummer (1-{{ totalGroups }})</label>
                            <input type="number" class="form-control" id="groupNumber" v-model="groupNumber" min="1" :max="totalGroups" required>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary betreuer" :disabled="!isConfigLoaded || loading">
                                <span v-if="loading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                <span v-else>Login</span>
                            </button>
                            <button type="button" @click="navigateTo('a_login.html')" class="btn btn-secondary" :disabled="!isConfigLoaded">
                                Zur√ºck zum Admin-Bereich
                            </button>
                        </div>
                    </form>
                    <div class="mt-3 text-center text-muted">
                        <small>Aktuelle Zeit: {{ currentDateTime }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script type="module">
        import { CONFIG_DEFAULTS, JSONBinAPI, Utils } from './common.js';

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    betreuerName: Utils.getStoredBetreuerName() || '',
                    groupNumber: Utils.getStoredGroupNumber() || '',
                    totalGroups: CONFIG_DEFAULTS.TOTAL_GROUPS, // Fallback, –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞
                    currentDateTime: '',
                    isConfigLoaded: false,
                    config: {}, // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    api: null,  // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ API
                    loading: false
                };
            },
            
            mounted() {
                this.initializePage();
                this.startClock();
            },
            
            methods: {
                /**
                 * –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è Vue-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç API
                 */
                initializePage() {
                    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã b_login.html...');
                    const success = Utils.initializePage(this); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ common.js

                    if (success) {
                        this.totalGroups = this.config.TOTAL_GROUPS; // –û–±–Ω–æ–≤–ª—è–µ–º totalGroups –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
                        console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', this.config);
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.');
                    }
                    this.updateDateTime();
                },

                /**
                 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞ –≤–æ—Å–ø–∏—Ç–∞—Ç–µ–ª—è
                 */
                async login() {
                    if (!this.isConfigLoaded) {
                        Utils.showAlert('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—Ö–æ–¥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.', 'danger');
                        return;
                    }

                    this.loading = true;

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –∏ –Ω–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã –≤ localStorage
                    Utils.storeBetreuerName(this.betreuerName);
                    Utils.storeGroupNumber(this.groupNumber);

                    Utils.showAlert('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...', 'success');
                    
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–æ–π
                    // –ü–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ localStorage, –∞ –Ω–µ URL, –∫–∞–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ
                    this.navigateTo('b_group.html');
                },

                /**
                 * –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
                 */
                updateDateTime() {
                    this.currentDateTime = Utils.getCurrentDateTime();
                },

                /**
                 * –ó–∞–ø—É—Å–∫–∞–µ—Ç —á–∞—Å—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
                 */
                startClock() {
                    this.updateDateTime();
                    setInterval(() => {
                        this.updateDateTime();
                    }, 60000);
                },

                /**
                 * –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–µ–∑ URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                 * (–º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ localStorage)
                 * @param {string} page - –ò–º—è —Ñ–∞–π–ª–∞ —Ü–µ–ª–µ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                 */
                navigateTo(page) {
                    Utils.navigateTo(page, this);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
