<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Admin Link Tool - Links und QR-Codes</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    #qrcode {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="app" class="container py-5">
    <h2 class="mb-4">Links und QR-Codes für Betreuer und Admin</h2>

    <div class="mb-3">
      <label for="groupSelect" class="form-label">Wähle eine Gruppe (для ссылок на конкретную группу):</label>
      <select id="groupSelect" class="form-select" v-model="selectedGroup">
        <option disabled value="">-- Gruppe auswählen --</option>
        <option v-for="gr in groups" :key="gr" :value="gr">Gruppe {{ gr }}</option>
      </select>
    </div>

    <div v-if="selectedGroup" class="mt-4">
      <h5>Выбранная группа: {{ selectedGroup }}</h5>
      <p>
        <a :href="adminGroupRelativeLink" class="btn btn-primary" target="_blank">
          Zur Gruppe {{ selectedGroup }} (Admin-Zugriff)
        </a>
      </p>
      <p class="mt-3">
        QR-Code для входа Betreuer'а в **Gruppe {{ selectedGroup }}**:
      </p>
      <div id="qrcode"></div>
    </div>

    <div class="mb-3 mt-5">
      <p>
        Общая ссылка для входа Betreuer'ов (без предварительного выбора группы):
        <a href="login.html" class="btn btn-secondary" target="_blank">
          Общая страница входа Betreuer'ов
        </a>
      </p>
    </div>
  </div>

  <script>
    const { createApp, watch } = Vue;

    const BASE_URL = 'https://raw.githack.com/alex-lysenko-de/stadtranderholung/main/';

    createApp({
      data() {
        return {
          groups: Array.from({ length: 15 }, (_, i) => i + 1),
          selectedGroup: '',
          qrcodeInstance: null
        };
      },
      computed: {
        // Относительная ссылка для прямого доступа админа к странице группы
        adminGroupRelativeLink() {
          return this.selectedGroup ? `group.html?gr=${this.selectedGroup}` : '';
        },
        // Относительная ссылка для входа Betreuer'а на страницу логина конкретной группы
        betreuerLoginRelativeLink() {
            return this.selectedGroup ? `login.html?gr=${this.selectedGroup}` : '';
        },
        // Абсолютная ссылка для QR-кода (на страницу логина Betreuer'а с параметром группы)
        qrCodeAbsoluteLink() {
            return this.betreuerLoginRelativeLink ? BASE_URL + this.betreuerLoginRelativeLink : '';
        }
      },
      watch: {
        selectedGroup(newVal) {
          if (!newVal) {
              // Если группа не выбрана, очищаем QR-код
              if (this.qrcodeInstance) {
                  document.getElementById("qrcode").innerHTML = "";
                  this.qrcodeInstance = null; // Сбрасываем инстанс
              }
              return;
          }

          this.$nextTick(() => {
            const linkToGenerateQr = this.qrCodeAbsoluteLink;

            // Удаляем старый QR-код, если он есть
            if (this.qrcodeInstance) {
              document.getElementById("qrcode").innerHTML = "";
            }

            // Создаём новый QR-код
            // Проверяем, что ссылка для QR-кода не пуста
            if (linkToGenerateQr) {
                this.qrcodeInstance = new QRCode(document.getElementById("qrcode"), {
                  text: linkToGenerateQr,
                  width: 180,
                  height: 180,
                  colorDark: "#000000",
                  colorLight: "#ffffff",
                  correctLevel: QRCode.CorrectLevel.H
                });
            }
          });
        }
      }
    }).mount('#app');
  </script>
</body>
</html>