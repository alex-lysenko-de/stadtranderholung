<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Gruppe auswählen mit QR-Code</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    #qrcode {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="app" class="container py-5">
    <h2 class="mb-4">Gruppe auswählen</h2>

    <div class="mb-3">
      <label for="groupSelect" class="form-label">Wähle eine Gruppe:</label>
      <select id="groupSelect" class="form-select" v-model="selectedGroup">
        <option disabled value="">-- Gruppe auswählen --</option>
        <option v-for="gr in groups" :key="gr" :value="gr">Gruppe {{ gr }}</option>
      </select>
    </div>

    <div v-if="selectedGroup" class="mt-4">
      <h5>Ausgewählte Gruppe: {{ selectedGroup }}</h5>
      <p>
        <a :href="link" class="btn btn-primary" target="_blank">
          Zur Gruppe {{ selectedGroup }}
        </a>
      </p>
      <div id="qrcode"></div>
    </div>
  </div>

  <script>
    const { createApp, watch } = Vue;

    createApp({
      data() {
        return {
          groups: Array.from({ length: 15 }, (_, i) => i + 1),
          selectedGroup: '',
          qrcodeInstance: null
        };
      },
      computed: {
        link() {
          return this.selectedGroup ? `login.html?gr=${this.selectedGroup}` : '';
        }
      },
      watch: {
        selectedGroup(newVal) {
          if (!newVal) return;

          this.$nextTick(() => {
            const link = this.link;

            // Удаляем старый QR-код, если он есть
            if (this.qrcodeInstance) {
              document.getElementById("qrcode").innerHTML = "";
            }

            // Создаём новый QR-код
            this.qrcodeInstance = new QRCode(document.getElementById("qrcode"), {
              text: link,
              width: 180,
              height: 180,
              colorDark: "#000000",
              colorLight: "#ffffff",
              correctLevel: QRCode.CorrectLevel.H
            });
          });
        }
      }
    }).mount('#app');
  </script>
</body>
</html>