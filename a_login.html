
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrator Login - Stadtranderholung</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="main.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div class="login-container">
            <div class="login-card">
                <div class="card-header admin">
                    <div class="admin-icon">🔧</div>
                    <h2 class="mb-0">Administrator</h2>
                    <p class="mb-0 mt-2">Stadtranderholung 2025</p>
                </div>
                <div class="navigation-section">
                    <div id="alertContainer"></div>
                    
                    <div v-if="hasParameters && isConfigLoaded" class="parameters-info">
                        <h6 class="mb-2">📋 Geladene Parameter:</h6>
                        <div v-for="(value, key) in loadedParameters" :key="key" class="parameter-item">
                            <strong>{{ key }}:</strong> {{ value }}
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button @click="navigateTo('a_overview.html')" class="btn btn-primary admin nav-button" :disabled="!isConfigLoaded">
                            📊 Gruppen Übersicht
                        </button>
                        
                        <button @click="navigateTo('a_bus.html')" class="btn btn-primary admin nav-button" :disabled="!isConfigLoaded">
                            🚌 Bus Übersicht
                        </button>
                        
                        <button @click="navigateTo('b_login.html')" class="btn btn-info nav-button" :disabled="!isConfigLoaded">
                            👤 Betreuer Login
                        </button>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <small class="text-muted">
                            Aktuelle Zeit: {{ currentDateTime }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script type="module">
        import { CONFIG_DEFAULTS, JSONBinAPI, Utils } from './common.js';

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentDateTime: '',
                    loadedParameters: {},
                    hasParameters: false,
                    isConfigLoaded: false, 
                    config: {}
                };
            },
            
            mounted() {
                this.initializePage(); // Используем стандартизированный метод инициализации
                this.startClock();
            },
            
            methods: {
                /**
                 * Стандартизированная инициализация страницы для Vue-компонентов
                 * Загружает конфигурацию и инициализирует API
                 */
                initializePage() {
                    console.log('Инициализация страницы a_login.html...');
                    const success = Utils.initializePage(this); // Вызов из common.js

                    if (success) {
                        // Отображение загруженных параметров в UI
                        this.loadedParameters = {};
                        for (const key in this.config) {
                            // Фильтрация внутренних ключей конфигурации, которые не должны отображаться
                            if (key !== 'API_BASE_URL') { 
                                this.loadedParameters[key] = this.config[key];
                            }
                        }
                        this.hasParameters = Object.keys(this.loadedParameters).length > 0;
                        
                        if (this.hasParameters) {
                            const paramCount = Object.keys(this.loadedParameters).length;
                            Utils.showAlert(
                                `${paramCount} Parameter erfolgreich geladen und gespeichert.`, 
                                'success'
                            );
                            console.log('Geladene Parameter:', this.loadedParameters);
                        }
                    } else {
                        console.error('Ошибка инициализации страницы.');
                    }
                    this.updateDateTime();
                },

                /**
                 * Навигация на указанную страницу
                 * @param {string} page - Имя файла целевой страницы
                 */
                navigateTo(page) {
                    Utils.navigateTo(page, this); // Использование стандартизированной навигации из common.js
                },

                /**
                 * Обновить текущие дату и время
                 */
                updateDateTime() {
                    this.currentDateTime = Utils.getCurrentDateTime(); // Использование Utils из common.js
                },

                /**
                 * Запускает часы для обновления времени каждую минуту
                 */
                startClock() {
                    this.updateDateTime();
                    setInterval(() => {
                        this.updateDateTime();
                    }, 60000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>